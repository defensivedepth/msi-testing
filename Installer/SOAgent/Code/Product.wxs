<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product Id="*" Name="SO-Agent" Language="1033" Version="1.0.0" Manufacturer="Security Onion Solutions" UpgradeCode="bc258551-c208-4c6b-97b0-a164eb550599">
    <Package InstallerVersion="301" Compressed="yes" InstallScope="perMachine"  Platform="x64"/>
    <MediaTemplate EmbedCab="yes" />
    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
    <Icon Id="Icon.ico" SourceFile="Resources\Icon.ico"/>
    <Property Id="ARPPRODUCTICON" Value="Icon.ico"></Property>
    <UIRef Id="WixUI_FeatureTree"/>
    <UIRef Id="WixUI_ErrorProgressText" />
    <UI Id="BypassEULA">
      <Publish Dialog="WelcomeDlg" Control="Next" Event="NewDialog" Value="VerifyReadyDlg" Order="2">Not Installed</Publish>
      <Publish Dialog="VerifyReadyDlg" Control="Back" Event="NewDialog" Value="WelcomeDlg" Order="4">NOT Installed</Publish>
    </UI>
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFiles64Folder">
        <Directory Id="CompanyFolder" Name="Elastic">
          <Directory Id="INSTALLLOCATION" Name="Agent">
            <Component Id="installer" Guid="2cbb30bc-0a99-aa6b-f2b3-5495290ae580" Win64="yes">
              <File Id="installer" Source="..\Deploy\so-elastic-agent_windows_amd64.exe" KeyPath="yes" />
            </Component>
          </Directory>
        </Directory>
      </Directory>
    </Directory>
    <Feature Id="SOAgent" Title="SOAgent" Description="Installs all the files needed for SOAgent" Level="1" AllowAdvertise="no" ConfigurableDirectory="INSTALLLOCATION">
      <ComponentRef Id="installer"/>
    </Feature>
    <SetProperty Id="Uninstall" Value="&quot;[INSTALLLOCATION]elastic-agent.exe&quot; uninstall" Before="Uninstall" Sequence="execute"/>
    <SetProperty Id="Install" Value="&quot;[#installer]&quot;" Before="Install" Sequence="execute"/>
    <CustomAction Id="Uninstall" BinaryKey="WixCA" DllEntry="WixQuietExec" Execute="deferred" Return="ignore" Impersonate="no"/>
    <CustomAction Id="Install" BinaryKey="WixCA" DllEntry="WixQuietExec" Execute="deferred" Return="ignore" Impersonate="no"/>
    <InstallExecuteSequence>
      <Custom Action="Uninstall" After="InstallInitialize">REMOVE=&quot;ALL&quot;</Custom>
      <Custom Action="Install" Before="InstallFinalize">Not Installed</Custom>
    </InstallExecuteSequence>
  </Product>
</Wix>