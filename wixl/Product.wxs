<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product Id="*" Name="SO-Agent" Language="1033" Version="1.0.0" Manufacturer="Security Onion Solutions" UpgradeCode="bc258551-c208-4c6b-97b0-a164eb550599">
    <Package InstallerVersion="301" Compressed="yes" InstallScope="perMachine" />
    <MediaTemplate EmbedCab="yes" />
    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFiles64Folder">
        <Directory Id="CompanyFolder" Name="Elastic">
          <Directory Id="INSTALLLOCATION" Name="Agent">
            <Component Id="installer" Guid="2cbb30bc-0a99-aa6b-f2b3-5495290ae580" Win64="yes">
              <File Id="installer" Source="so-elastic-agent_windows_amd64.exe" KeyPath="yes" />
            </Component>
          </Directory>
        </Directory>
      </Directory>
    </Directory>
    <Feature Id="SOAgent" Title="SOAgent" Description="Installs all the files needed for SOAgent" Level="1" AllowAdvertise="no" ConfigurableDirectory="INSTALLLOCATION">
      <ComponentRef Id="installer"/>
    </Feature>
    <Binary Id="WixCA" SourceFile="WixCA.dll" />
    <CustomAction Id="SetInstall" Property="Install" Value="&quot;[#installer]&quot;"></CustomAction>
    <CustomAction Id="SetUninstall" Property="Uninstall" Value="&quot;[INSTALLLOCATION]elastic-agent.exe&quot; uninstall"></CustomAction>
    <CustomAction Id="Uninstall" BinaryKey="WixCA" DllEntry="WixQuietExec" Execute="deferred" Return="ignore" Impersonate="no"/>
    <CustomAction Id="Install" BinaryKey="WixCA" DllEntry="WixQuietExec" Execute="deferred" Return="ignore" Impersonate="no"/>
    <InstallExecuteSequence>
      <Custom Action="SetUninstall" After="InstallInitialize">REMOVE=&quot;ALL&quot;</Custom>
      <Custom Action="Uninstall" After="SetUninstall">REMOVE=&quot;ALL&quot;</Custom>
      <Custom Action="SetInstall" Before="Install">Not Installed</Custom>
      <Custom Action="Install" Before="InstallFinalize">Not Installed</Custom>
    </InstallExecuteSequence>
  </Product>
</Wix>